<!DOCTYPE html>
<html>
<head>
  <title>Reynolds Number Calculator</title>
</head>
<body>
    <h1>Reynolds Number Calculator</h1>
    <p>EEasily calculate the Reynolds Number (Re) of a gas or liquid given its kinematic viscosity or dynamic viscosity and density, <br />
      its velocity and characteristic length. Multiple metric and imperial measurement units are supported by the Reynolds Number calculator.
    </p>
    <p>
      Solve via:
      <select id="calcSelect">
        <option value="dvd" selected>Dynamic viscosity & density</option>
        <option value="kiv">Kinematic viscosity</option>
      </select>
    </p>
    <div id="dvdContainer" class="containers">
      <p>
        Dynamic viscosity:
        <input type="number" id="dynamicVal">
        <select name="dynamic" id="dynamicSelect">
          <option value="kgms" selected>kg/m·s</option>
          <option value="nsm2">N·s/m2</option>
          <option value="pas">Pa·s</option>
          <option value="cp">cP</option>
        </select>
      </p>
      <p>
        Density: 
        <input type="number" id="densityVal">
        <select name="density" id="densitySelect">
          <option value="gm3">g/m3</option>
          <option value="gcm3">g/cm3</option>
          <option value="kgm3" selected>kg/m3</option>
          <option value="kgcm3">kg/cm3</option>
          <option value="ozin3">oz/cu in</option>
          <option value="lbft3">lb/cu ft</option>
          <option value="lbyd3">lb/cu yd</option>
          <option value="gl">g/litre</option>
        </select>
      </p>
    </div>
    <p id="kivContainer" class="containers" style="display: none;">
      Kinematic viscosity: 
      <input type="number" id="kinViscVal">
      <select id="kinViscSelect" name="kinematicV">
        <option value="m2s" selected>m2/s</option>
        <option value="st">Stokes</option>
        <option value="cst">cSt</option>
      </select>
    </p>
    <p>
      Flow velocity: 
      <input type="number" id="flowVVal">
      <select id="flowVSelect" name="flowVelocity" >
        <option value="ms" selected>m/s</option>
        <option value="kms">km/s</option>
        <option value="mps">miles/s</option>
        <option value="kmh">km/h</option>
        <option value="mph">miles/h</option>
        <option value="ins">in/s</option>
        <option value="fts">ft/s</option>
        <option value="yds">yd/s</option>
        <option value="knots">knots</option>
      </select>
    </p>
    <p>
      Characteristic length: 
      <input type="number" id="charLenVal">
      <select id="charLenSelect" name="charLength">
        <option value="nm">nm</option>
        <option value="μm">μm</option>
        <option value="mm">mm</option>
        <option value="cm">cm</option>
        <option value="m" selected>m</option>
        <option value="km">km</option>
        <option value="in">in</option>
        <option value="ft">ft</option>
        <option value="yd">yd</option>
        <option value="mi">mi</option>
      </select>
    </p>
    
    <button id="calcBtn">Calculate</button>
    <button id="resetBtn">Reset</button>
    <hr>
    <div>
      <h3>Result:</h3>
      <h3 id="calcResults">Result will appear here...</h3>
    </div>

    <script>
      // Get required elements from the HTML
      const calcSelectEl = document.getElementById("calcSelect");
      const dynamicValEl = document.getElementById("dynamicVal");
      const densityValEl = document.getElementById("densityVal");
      const kinViscValEl = document.getElementById("kinViscVal");
      const flowVValEl = document.getElementById("flowVVal");
      const charLenValEl = document.getElementById("charLenVal");

      const dynamicSelectEl = document.getElementById("dynamicSelect");
      const densitySelectEl = document.getElementById("densitySelect");
      const kinViscSelectEl = document.getElementById("kinViscSelect");
      const flowVSelectEl = document.getElementById("flowVSelect");
      const charLenSelectEl = document.getElementById("charLenSelect");

      const containtersEl = document.querySelectorAll(".containers");

      const calcBtnEl = document.getElementById('calcBtn');
      const resetBtnEl = document.getElementById('resetBtn');
      const calcResultsEl = document.getElementById('calcResults') 

      const UNITS = {
        time: {
          ns: 0,
          ms: 0,
          s: 1,
          m: 0.01666666666,
          h: 0.0002777777777777778,
          days: 0.000011574074074074073,
          wks: 0.0000016534391534391535,
          mos: 3.8025705376834734e-7,
          yrs: 3.1688087814028954e-8,
        },
      }

      /*************** FUNCTIONS ***************/
      function toSIUnit(type, unit, value) {
        return value / UNITS[type][unit];
      }

      function fromSIUnit(type, unit, value) {
        return value * UNITS[type][unit];
      }

      function handlecalcSelectChange(e) {
        const value = e.target.value

        containtersEl.forEach((container) => {
          let idVal = container.id.slice(0, 3)
          if (value == idVal) {
            container.style.display = 'block'
          } else {
            container.style.display = 'none'
          }
        })

        unitContainersEl.forEach((container) => {
          let idVal = container.id.slice(0, 2)
          if (value == idVal) {
            container.style.display = 'block'
          } else {
            container.style.display = 'none'
          }
        })
      }

      function handleHLInputChange(e) {
        const value = parseFloat(e.target.value)
        const id = e.target.id
        let val1 = 0
        let val2 = 0 
        halfLifeEl.forEach((input) => {
          if (input.id != id) {
            if (id == 'halfLifeVal') {
              val1 =  isNaN(value) ? '' : (Math.log(2) / value);
              val2 =  isNaN(value) ? '' : (value / Math.log(2));
              input.value = input.id == 'decConstVal' ? val1 : val2
            } else if (id == 'decConstVal') {
              val1 =  isNaN(value) ? '' : (Math.log(2) / value);
              val2 =  isNaN(value) ? '' : (1 / value);
              input.value = input.id == 'halfLifeVal' ? val1 : val2
            } else {
              val1 =  isNaN(value) ? '' : (Math.log(2) * value);
              val2 =  isNaN(value) ? '' : (1 / value);
              input.value = input.id == 'halfLifeVal' ? val1 : val2
            }
          }
        })
      }

      function handleHLSelectChange(e) {
        const index = e.target.selectedIndex
        const id = e.target.id
        halfLifeSelectEl.forEach((select) => {
          if (select.id != id) {
            select.selectedIndex = index
          }
        })
      }

      function prepareUnits() {
        let iq = parseFloat(iniQtyValEl.value) ?? 0;
        let rq = parseFloat(remQtyValEl.value) ?? 0;
        let te = parseFloat(timeValEl.value) ?? 0;
        let hl = parseFloat(document.getElementById('halfLifeVal').value) ?? 0;

        let teUnit = timeSelectEl.value;
        let hlUnit = document.getElementById('halfLifeSelect').value;

        te = toSIUnit("time", teUnit, te);
        hl = toSIUnit("time", hlUnit, hl);

        return { iq, rq, te , hl};
      }

      function calculateResults() {
          // Retrieve input values
          // const observedVal = parseFloat(observedValEl.value);
          // const trueVal = parseFloat(trueValEl.value);

          if (isNaN(observedVal) || isNaN(trueVal)) {
            alert("Please Enter All Details.");
            return;
          } else if (trueVal < 0  ) {
            alert("The relative uncertainty cannot be negative.");
              return;
          }

          try {
            const results = ((observedVal -trueVal) / trueVal) * 100
            
            calcResultsEl.innerHTML = `<p> Percent error: ${results.toFixed(2) * 1}%</p>`
          } catch (error) {
            alert("Something Went Wrong!!!");
            resethandler()
          }
      }

      function resetForm() {
        observedValEl.value = ""
        trueValEl.value = ""
      }

      function resetResult() {
        calcResultsEl.innerHTML = "<p>Result will appear here...</p>";
      } 

      function resethandler() {
        resetForm();
        resetResult();
      }

      /*************** EVENTLISTINERS ***************/
      [dynamicValEl, densityValEl, kinViscValEl, flowVValEl, charLenValEl].forEach((el) => {
        el.addEventListener("input", resetResult);
      }); 
            
      [dynamicSelectEl, densitySelectEl, kinViscSelectEl, flowVSelectEl, charLenSelectEl].forEach((el) => {
        el.addEventListener("change", resetResult);
      }); 

      calcSelectEl.addEventListener("change", handlecalcSelectChange)

      resetBtnEl.addEventListener("click", resethandler);
      calcBtnEl.addEventListener("click", calculateResults);

    </script>
</body>
</html>
