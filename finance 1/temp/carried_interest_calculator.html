<!DOCTYPE html>
<html>
<head>
  <title>Carried Interest Calculator</title>
</head>
<body>
    <h1>Carried Interest Calculator</h1>
    <p>
      Initial fund value:
      <input type="number" id="iniFundVal">
    </p>
    <p>
      Final fund value: 
      <input type="number" id="finFundVal">
    </p>
    <p>Carry interest:</p>
    <p>
      Hold period:
      <input type="number" id="holdPeriod" value="10"> yrs
    </p>
    <p>
      Hurdle rate:
      <input type="number" id="hurdleRate" value="0">%
    </p>
    <p>
      Carried interest:
      <input type="number" id="carriedInterest" value="20">%
    </p>
    <p>
      GP (general partner) catch-up:
      <select id="catchUpSelect">
        <option value="no" selected>No</option>
        <option value="yes">Yes</option>
      </select>
    </p>


    <button id="calcBtn">Calculate</button>
    <button id="resetBtn">Reset</button>
    <hr>
    <div>
      <h3>Result:</h3>
      <h3 id="calcResults">Result will appear here...</h3>
    </div>

    <script>
      // Get required elements from the HTML
      const iniFundValEl = document.getElementById("iniFundVal");
      const finFundValEl = document.getElementById("finFundVal");
      const holdPeriodEl = document.getElementById("holdPeriod");
      const hurdleRateEl = document.getElementById("hurdleRate");
      const carriedInterestEl = document.getElementById("carriedInterest");
      const catchUpSelectEl = document.getElementById("catchUpSelect");

      const calcBtnEl = document.getElementById('calcBtn');
      const resetBtnEl = document.getElementById('resetBtn');
      const calcResultsEl = document.getElementById('calcResults') 

      function createElement() {
        const newDiv = `
            <p>
              <label for="i11-span">Fund return: &nbsp;</label>
              <span
                data-id="i11"
                step="any"
                id="i11-span"
                class="spans"
              ></span>%
            </p>
            <p>
              <label for="i12-span">The GP profit split is: &nbsp;</label>
              <span
                data-id="i12"
                step="any"
                id="i12-span"
                class="spans"
              ></span>
            </p>
            <p>
              <label for="i13-span">The total GP carry distribution is: &nbsp;</label>
              <span
                data-id="i13"
                step="any"
                id="i13-span"
                class="spans"
              ></span>ðŸ’°
            </p>
        `
        const newDiv2 = `
            <p>
              <label for="i14-span">The GP catch-up is: &nbsp;</label>
              <span
                data-id="i14"
                step="any"
                id="i14-span"
                class="spans"
              ></span>ðŸ’°
            </p>
         `
        if (catchUpSelectEl.value === "yes") {
          return newDiv + newDiv2
        }

        return newDiv
      }

      function setResult(resultObj) {
        for (key of Object.keys(resultObj)) {
          let val = resultObj[key].result;
          let id = resultObj[key].type;

          if (isNaN(val)) {
           alert("Your input resulted in NAN.\n 0/0 \n Try again with valid input.");
            return;
          }
          if (Math.abs(val) === Infinity) {
            alert("Your input resulted in Infinity. \nDivision by zero. \nTry again with valid input.");
            return;
          }
          const span = document.getElementById(`${id}-span`);
          span.textContent = `${parseFloat(val)}`;
        }
      }

      function calculateResults() {
          // Retrieve input values
          const iniFundVal = parseFloat(iniFundValEl.value);
          const finFundVal = parseFloat(finFundValEl.value);
          const holdPeriod = parseFloat(holdPeriodEl.value);
          const hurdleRate = parseFloat(hurdleRateEl.value);
          const carriedInterest = parseFloat(carriedInterestEl.value);

          if (isNaN(iniFundVal) || iniFundVal < 0 || isNaN(finFundVal) || finFundVal < 0 || isNaN(holdPeriod) || holdPeriod < 1 ||
            isNaN(hurdleRate) || hurdleRate < 0 || isNaN(carriedInterest) || carriedInterest < 0
          ) {
            alert("Please Enter All Details.");
            return;
          }

          try {
            const fundReturn = ((finFundVal / iniFundVal) - 1) * 100
            
            if (fundReturn < hurdleRate ) {
              calcResultsEl.innerHTML = `
                <p>As the fund return is lower than the hurdle rate, you will not incur any carry distribution ðŸ’¸</p>
            ` 
              return 
            }
            const resultElement = createElement()
            calcResultsEl.innerHTML = resultElement 

            const carryD = (finFundVal - (iniFundVal * ((1 + (hurdleRate / 100)) ** holdPeriod))) * (carriedInterest / 100)
            
            const results = {
              1: { result: Math.abs(fundReturn) > 1 ? fundReturn.toFixed(2) : fundReturn.toPrecision(2), type: "i11" },
              2: { result: Math.abs(carryD) > 1 ? carryD.toFixed(2) : carryD.toPrecision(2), type: "i12" },
              3: { result: Math.abs(carryD) > 1 ? carryD.toFixed(4) : carryD.toPrecision(4), type: "i13" },
            }
            setResult(results)
            if (catchUpSelectEl.value === "yes") {
              const GPDist = 0
              const results = {
              4: { result: Math.abs(GPDist) > 1 ? GPDist.toFixed(2) : GPDist.toPrecision(2), type: "i14" },
            }
            }

          } catch (error) {
            alert("Something Went Wrong!!!");
            resetResult()
            return;
          }
      }

      function resetForm() {
        iniFundValEl.value = ""
        finFundValEl.value = ""
        holdPeriodEl.value = "10"
        hurdleRateEl.value = "0"
        carriedInterestEl.value = "20"
        catchUpSelectEl.selectedIndex = "0"
      }

      function resetResult() {
        calcResultsEl.innerHTML = "<p>Result will appear here...</p>";
      } 

      function resethandler() {
        resetForm();
        resetResult();
      }
      
      [iniFundValEl, finFundValEl, holdPeriodEl, hurdleRateEl, carriedInterestEl].forEach((el) => {
        el.addEventListener("input", resetResult);
      });  
      catchUpSelectEl.addEventListener("change", resetResult);
      
      resetBtnEl.addEventListener("click", resethandler);
      calcBtnEl.addEventListener("click", calculateResults);

    </script>
</body>
</html>
